<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>ğŸ¦ Ø£Ø³Ø·ÙˆØ±Ø© Ù…Ù„Ùƒ Ø§Ù„ØºØ§Ø¨Ø©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body { overflow: hidden; background: #2d5a27; font-family: 'Segoe UI', Tahoma, sans-serif; }

        #gameContainer { position: relative; width: 100vw; height: 100vh; background: #3d7038; }
        
        /* Ø§Ù„Ø¨Ø­ÙŠØ±Ø© ÙˆØ§Ù„Ù…Ù†ØµØ© */
        #lake { position: absolute; bottom: 20px; left: 20px; width: 220px; height: 160px; background: #4fa1ff; border-radius: 50%; border: 4px solid #fff; z-index: 10; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; }
        #platform { position: absolute; top: -30px; background: #8b4513; padding: 5px; border-radius: 5px; width: 120px; text-align: center; }

        /* Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª */
        .entity { position: absolute; transition: transform 0.2s linear; display: flex; align-items: center; justify-content: center; z-index: 50; pointer-events: none; }
        #character { font-size: 60px; z-index: 100; transition: left 0.1s ease-out, top 0.1s ease-out; }
        #hunter { font-size: 50px; display: none; z-index: 110; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        #hud { position: fixed; top: 10px; width: 100%; display: flex; justify-content: space-around; z-index: 2000; }
        .status { background: rgba(0,0,0,0.8); color: #ffd700; padding: 10px; border-radius: 15px; border: 1px solid #ffd700; min-width: 80px; text-align: center; }
        
        #owl { position: fixed; bottom: 20px; right: 20px; font-size: 4em; z-index: 1000; cursor: pointer; transition: 1s; }
        .digging { filter: brightness(0.4) scale(0.7); }
    </style>
</head>
<body>

<div id="hud">
    <div class="status">ğŸ’° <span id="coins">0</span></div>
    <div class="status">ğŸ§¬ <span id="stage">Ø´Ø¨Ù„</span></div>
    <div class="status" id="hStatus">ğŸ¹ Ù†Ø§Ø¦Ù…</div>
</div>

<div id="gameContainer">
    <div id="lake"><div id="platform">Ù…Ù†ØµØ© Ø§Ù„Ù…ØºØ§Ù…Ø±Ø§Øª</div>ğŸ›¡ï¸ Ù…Ù†Ø·Ù‚Ø© Ø¢Ù…Ù†Ø©</div>
    <div id="character" class="entity">ğŸ¦</div>
    <div id="hunter" class="entity">ğŸ•µï¸â€â™‚ï¸</div>
</div>

<div id="owl">ğŸ¦‰</div>

<script>
    const char = document.getElementById('character');
    const hunter = document.getElementById('hunter');
    const owl = document.getElementById('owl');
    const container = document.getElementById('gameContainer');
    
    let coins = 0;
    let evolution = 0; // 0:Ø´Ø¨Ù„, 1:Ø´Ø§Ø¨, 2:Ø£Ø³Ø¯
    let isDigging = false;
    let hunterActive = false;
    let speed = 1;

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø·ÙˆØ± (ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ÙƒØ±ÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) ---
    function moveHandler(e) {
        if (isDigging) return;
        let x, y;
        if (e.touches) {
            x = e.touches[0].clientX;
            y = e.touches[0].clientY;
        } else {
            x = e.clientX;
            y = e.clientY;
        }
        char.style.left = (x - 40) + 'px';
        char.style.top = (y - 40) + 'px';
        checkGameLogic(x, y);
    }

    container.addEventListener('touchmove', moveHandler, {passive: false});
    container.addEventListener('mousemove', (e) => { if(e.buttons === 1) moveHandler(e); });

    // --- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ---
    function createItem(emoji, cls) {
        const el = document.createElement('div');
        el.className = 'entity ' + cls;
        el.innerHTML = emoji;
        resetPos(el);
        container.appendChild(el);
        return el;
    }

    function resetPos(el) {
        el.style.left = Math.random() * (window.innerWidth - 60) + 'px';
        el.style.top = Math.random() * (window.innerHeight - 60) + 'px';
    }

    let prey = createItem('ğŸ‡', 'prey');
    let chameleon = createItem('ğŸ¦', 'chameleon');
    let chest = createItem('ğŸ“¦', 'chest');

    // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
    function checkGameLogic(x, y) {
        const charRect = char.getBoundingClientRect();
        
        // 1. Ø§Ù„ØµÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø±
        if (isColliding(charRect, prey.getBoundingClientRect())) {
            coins += (evolution + 1) * 5;
            resetPos(prey);
            updateHUD();
            checkEvolution();
        }

        // 2. Ø§Ù„Ø­Ø±Ø¨Ø§Ø¡ (Ù…Ø´
