<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { width: 100vw; height: 100vh; overflow: hidden; background: #2d5a27; touch-action: none; font-family: sans-serif; }
        
        #game-area { position: relative; width: 100%; height: 100%; background: #3d7038; }
        
        /* Ø§Ù„Ø´Ø¨Ù„ */
        #character { 
            position: absolute; font-size: 50px; 
            width: 60px; height: 60px;
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; pointer-events: none;
            left: 50%; top: 50%; transform: translate(-50%, -50%);
        }

        .tree { position: absolute; font-size: 40px; z-index: 10; pointer-events: none; }
        .item { position: absolute; font-size: 35px; z-index: 50; transition: transform 0.2s; }
        #lake { position: absolute; bottom: 0; left: 0; width: 150px; height: 150px; background: rgba(0, 150, 255, 0.5); border-radius: 0 100% 0 0; border: 3px solid white; z-index: 5; display: flex; align-items: flex-end; padding: 10px; color: white; font-size: 12px; }

        #hud { position: fixed; top: 0; width: 100%; display: flex; justify-content: space-around; background: rgba(0,0,0,0.5); color: gold; padding: 10px; z-index: 2000; pointer-events: none; }
        #owl { position: fixed; bottom: 20px; right: 20px; font-size: 50px; z-index: 2000; cursor: pointer; }
        .digging { filter: brightness(0.3); }
    </style>
</head>
<body>

<div id="hud">
    <div>ğŸ’° <span id="coins">0</span></div>
    <div>ğŸ§¬ <span id="level">Ø´Ø¨Ù„</span></div>
    <div id="hStatus">ğŸ¹ Ù†Ø§Ø¦Ù…</div>
</div>

<div id="game-area">
    <div id="lake">Ø§Ù„Ø¨Ø­ÙŠØ±Ø©</div>
    <div id="character">ğŸ¦</div>
    <div id="hunter" class="item" style="display:none;">ğŸ•µï¸â€â™‚ï¸</div>
    <div id="prey" class="item">ğŸ‡</div>
    <div id="chameleon" class="item">ğŸ¦</div>

    <div class="tree" style="top:20%; left:15%;">ğŸŒ³</div>
    <div class="tree" style="top:50%; left:80%;">ğŸŒ²</div>
    <div class="tree" style="top:70%; left:20%;">ğŸŒ³</div>
</div>

<div id="owl">ğŸ¦‰</div>

<script>
    const char = document.getElementById('character');
    const gameArea = document.getElementById('game-area');
    const coinsTxt = document.getElementById('coins');
    const levelTxt = document.getElementById('level');
    const hunter = document.getElementById('hunter');
    const owl = document.getElementById('owl');
    
    let coins = 0;
    let evolution = 0;
    let speedMult = 1; // Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ¨Ø·ÙŠØ¦
    let isDigging = false;

    // --- Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ---
    // Ù†Ø³ØªØ®Ø¯Ù… 'touchstart' Ùˆ 'touchmove' Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
    function updateLocation(e) {
        if (isDigging) return;
        e.preventDefault();
        let touch = e.touches[0];
        
        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø¨Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ¨Ø§Ø¹
        // Ø¥Ø°Ø§ Ù„Ù…Ø³Ù†Ø§ Ø§Ù„Ø­Ø±Ø¨Ø§Ø¡ØŒ Ø§Ù„Ø­Ø±ÙƒØ© Ù‡ØªÙƒÙˆÙ† Ø£Ø«Ù‚Ù„ (Ù†Ø­Ø§ÙƒÙŠ Ø§Ù„ØªØ¨Ø·ÙŠØ¦)
        let targetX = touch.clientX;
        let targetY = touch.clientY;

        char.style.left = targetX + 'px';
        char.style.top = targetY + 'px';
        
        checkCollisions();
    }

    gameArea.addEventListener('touchstart', updateLocation, {passive: false});
    gameArea.addEventListener('touchmove', updateLocation, {passive: false});

    // --- Ø§Ù„ØªØµØ§Ø¯Ù… ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª ---
    function checkCollisions() {
        let charRect = char.getBoundingClientRect();
        let prey = document.getElementById('prey');
        let cham = document.getElementById('chameleon');

        // 1. ØµÙŠØ¯ Ø§Ù„ÙØ±ÙŠØ³Ø©
        if (isHit(charRect, prey.getBoundingClientRect())) {
            coins += (evolution === 2) ? 20 : 10; // Ø§Ù„Ø£Ø³Ø¯ ÙŠØ§Ø®Ø¯ Ø£ÙƒØªØ±
            if(evolution === 2) { // Ø§Ù„Ø£Ø³Ø¯ ÙŠÙ‚Ø¶ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµÙŠØ¯
                prey.style.transform = "scale(0)";
                setTimeout(() => { prey.style.transform = "scale(1)"; spawn(prey); }, 400);
            } else {
                spawn(prey);
            }
            updateStats();
        }

        // 2. Ø§Ù„Ø­Ø±Ø¨Ø§Ø¡ (Ø§Ù„ØªØ¨Ø·Ø¦)
        if (isHit(charRect, cham.getBoundingClientRect())) {
            // Ø¨Ù…Ø§ Ø¥Ù† Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„ØµØ¨Ø§Ø¹ØŒ Ø§Ù„ØªØ¨Ø·ÙŠØ¦ Ù‡Ù†Ø§ "Ø¨ØµØ±ÙŠ" Ùˆ "ØªØ¹Ø·ÙŠÙ„ÙŠ"
            gameArea.removeEventListener('touchmove', updateLocation); // ÙˆÙ‚Ù Ø§Ù„Ø­Ø±ÙƒØ©
            char.style.filter = "grayscale(1) blur(2px)";
            setTimeout(() => {
                gameArea.addEventListener('touchmove', updateLocation, {passive: false});
                char.style.filter = "none";
            }, 3000); // ØªØ¬Ù…Ø¯ Ù„Ù…Ø¯Ø© 3 Ø«ÙˆØ§Ù†ÙŠ
            spawn(cham);
        }
    }

    function isHit(r1, r2) {
        return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);
    }

    function spawn(el) {
        el.style.left = Math.random() * 80 + 'vw';
        el.style.top = Math.random() * 80 + 'vh';
    }

    function updateStats() {
        coinsTxt.innerText = coins;
        if (coins >= 50 && evolution === 0) { evolution = 1; levelTxt.innerText = "Ø´Ø§Ø¨"; char.innerText = "ğŸ†"; }
        if (coins >= 150 && evolution === 1) { evolution = 2; levelTxt.innerText = "Ø£Ø³Ø¯ Ù…Ù„Ùƒ"; char.innerText = "ğŸ¦"; char.style.fontSize = "70px"; }
    }

    // --- Ø§Ù„Ø¨ÙˆÙ…Ø© ÙˆØ§Ù„Ø­ÙØ± (NFT) ---
    owl.onclick = () => {
        if (isDigging) return;
        isDigging = true;
        char.classList.add('digging');
        alert("ğŸ¦‰ Ø§Ù„Ø¨ÙˆÙ…Ø© ØªØ¹Ù„Ù…Ùƒ: Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ± Ø¹Ù† Ø´Ø¸Ø§ÙŠØ§ NFT (Ø§Ù†ØªØ¸Ø± 15 Ø«Ø§Ù†ÙŠØ©)");
        
        setTimeout(() => {
            isDigging = false;
            char.classList.remove('digging');
            coins += 50;
            alert("âœ¨ ÙˆØ¬Ø¯Øª ÙƒÙ†Ø² NFT Ø¨Ù‚ÙŠÙ…Ø© 50 Ø¹Ù…Ù„Ø©!");
            updateStats();
        }, 15000);
    };

    // --- Ø§Ù„ØµÙŠØ§Ø¯ ÙˆØ§Ù„Ø¨Ø­ÙŠØ±Ø© ---
    setInterval(() => {
        let hunterGo = Math.random() > 0.5;
        hunter.style.display = hunterGo ? 'block' : 'none';
        document.getElementById('hStatus').innerText = hunterGo ? "ğŸ¹ Ø§Ù‡Ø±Ø¨!" : "ğŸ¹ Ù†Ø§Ø¦Ù…";
        if(hunterGo) spawn(hunter);
    }, 10000);

    setInterval(() => {
        if (hunter.style.display === 'block') {
            let hX = hunter.offsetLeft, hY = hunter.offsetTop;
            let cX = char.offsetLeft, cY = char.offsetTop;
            
            // Ù„Ùˆ Ø§Ù„Ø£Ø³Ø¯ ÙÙŠ Ø§Ù„Ø¨Ø­ÙŠØ±Ø© Ø§Ù„ØµÙŠØ§Ø¯ ÙŠØ¨Ø¹Ø¯
            if (cX < 150 && cY > (window.innerHeight - 150)) {
                hunter.style.left = (hX + 10) + 'px';
            } else {
                hunter.style.left = hX + (cX - hX) * 0.02 + 'px';
                hunter.style.top = hY + (cY - hY) * 0.02 + 'px';
            }
            
            if(isHit(char.getBoundingClientRect(), hunter.getBoundingClientRect())) {
                coins = Math.max(0, coins - 1);
                coinsTxt.innerText = coins;
            }
        }
    }, 50);

    spawn(document.getElementById('prey'));
    spawn(document.getElementById('chameleon'));
</script>
</body>
</html>

