<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¦ LAST - Ø§Ù„Ø´Ø¨Ù„ Ø¶Ø¯ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: Arial, sans-serif; overflow: hidden; background: #1a5f1a; touch-action: none; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #splash { position: fixed; inset: 0; background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; transition: 0.5s; }
        #splash.hide { opacity: 0; pointer-events: none; }
        .splash-logo { font-size: 8em; animation: bounce 1.5s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* Ø¹Ø§Ù„Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© */
        #game { position: fixed; inset: 0; display: none; }
        #game.active { display: block; }

        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØºØ§Ø¨Ø©: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø³ÙˆØ§Ø¯ ÙˆØ¬Ø¹Ù„Ù‡Ø§ ØªØºØ·ÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù† */
        #world { 
            position: absolute; 
            width: 5000px; 
            height: 5000px; 
            background: #1a5f1a; 
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="60" x="10" font-size="50">ğŸŒ³</text></svg>');
            background-size: 150px 150px;
        }

        /* Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        #player, #hunter { position: absolute; width: 80px; height: 80px; font-size: 4em; display: flex; align-items: center; justify-content: center; z-index: 500; }
        #player { transition: transform 0.1s; }
        #hunter { z-index: 450; transition: all 0.3s linear; }
        
        .item { position: absolute; font-size: 3.5em; cursor: pointer; z-index: 400; transition: transform 0.2s; }
        .item:active { transform: scale(1.2); }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (HUD) */
        #hud { position: fixed; top: 10px; left: 10px; right: 10px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; z-index: 2000; }
        .stat { background: rgba(0,0,0,0.8); color: #ffd700; padding: 10px 5px; border-radius: 12px; border: 2px solid #ffd700; font-weight: bold; text-align: center; font-size: 0.9em; }
        
        #progress { position: fixed; bottom: 150px; left: 50%; transform: translateX(-50%); width: 80%; height: 30px; background: #222; border-radius: 15px; display: none; border: 3px solid gold; z-index: 3000; overflow: hidden; }
        #progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #4caf50, #81c784); }

        #msg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: white; padding: 25px; border-radius: 20px; text-align: center; display: none; z-index: 4000; border: 3px solid gold; width: 80%; }
        #warn { position: fixed; top: 120px; left: 50%; transform: translateX(-50%); background: #ff0000; color: white; padding: 12px 25px; border-radius: 15px; display: none; z-index: 2000; font-weight: bold; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        #shop-btn { position: fixed; bottom: 30px; right: 20px; background: #ffd700; color: #000; padding: 15px 30px; border-radius: 50px; font-weight: bold; z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div id="splash">
        <div class="splash-logo">ğŸ¦</div>
        <h1 style="color: gold; margin-top: 20px;">Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ù„ÙŠÙˆÙ† Ø§Ù„Ø£Ø®ÙŠØ±</h1>
        <button onclick="startGame()" style="margin-top: 30px; padding: 15px 40px; font-size: 1.5em; border-radius: 30px; border: none; background: gold; font-weight: bold;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="game">
        <div id="world" id="world-map">
            <div id="player">ğŸ¦</div> <div id="hunter">ğŸ¯</div> </div>

        <div id="hud">
            <div class="stat">âš›ï¸ <span id="zaar">0</span></div>
            <div class="stat">ğŸ’ <span id="last">0.00</span></div>
            <div class="stat">ğŸ“Š Lvl: <span id="lvl">1</span></div>
            <div class="stat" onclick="saveGame()">ğŸ’¾ Ø­ÙØ¸</div>
        </div>

        <div id="warn">ğŸš¨ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ØªØ·Ø§Ø±Ø¯Ùƒ!</div>
        <div id="progress"><div id="progress-bar"></div></div>
        <div id="msg"></div>
        <div id="shop-btn" onclick="openShop()">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</div>
    </div>

    <script>
        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        const state = { 
            px: 500, py: 500, // Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø¨Ù„
            hx: 800, hy: 800, // Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØµÙŠØ§Ø¯
            zaar: 0, last: 0, lvl: 1,
            isDigging: false,
            camX: 0, camY: 0
        };

        const E = {
            world: document.getElementById('world'),
            player: document.getElementById('player'),
            hunter: document.getElementById('hunter'),
            zaar: document.getElementById('zaar'),
            last: document.getElementById('last'),
            lvl: document.getElementById('lvl'),
            msg: document.getElementById('msg'),
            warn: document.getElementById('warn'),
            bar: document.getElementById('progress-bar'),
            prog: document.getElementById('progress')
        };

        function startGame() {
            document.getElementById('splash').classList.add('hide');
            document.getElementById('game').classList.add('active');
            loadGame();
            initItems();
            requestAnimationFrame(gameLoop);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ ÙÙŠ Ø£Ù…Ø§ÙƒÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
        function initItems() {
            for(let i=0; i<20; i++) {
                const el = document.createElement('div');
                el.className = 'item';
                el.textContent = 'ğŸ“¦';
                const x = Math.random() * 4000 + 100;
                const y = Math.random() * 4000 + 100;
                el.style.left = x + 'px';
                el.style.top = y + 'px';
                // Ø¬Ø¹Ù„ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙŠÙØªØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡
                el.onclick = (e) => {
                    e.stopPropagation();
                    checkAndDig(x, y, el);
                };
                E.world.appendChild(el);
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³Ø§ÙØ© Ù„ÙØªØ­ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
        function checkAndDig(ix, iy, el) {
            const dist = Math.sqrt((state.px - ix)**2 + (state.py - iy)**2);
            if(dist < 150) { // Ù…Ø³Ø§ÙØ© ÙƒØ§ÙÙŠØ© Ù„Ù„ÙØªØ­
                startDigging(el);
            } else {
                showMsg("Ø§Ù‚ØªØ±Ø¨ Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ù„Ù„Ø­ÙØ±!");
            }
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ± Ø¨Ù€ 4 Ù…Ø±Ø§Ø­Ù„ (15 Ø«Ø§Ù†ÙŠØ©)
        function startDigging(el) {
            if(state.isDigging) return;
            state.isDigging = true;
            E.prog.style.display = 'block';
            
            let progress = 0;
            const stages = ["ØªØ­Ø³Ø³ Ø§Ù„Ø£Ø±Ø¶..", "Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø¨Ø´..", "Ø­ÙØ± Ø¹Ù…ÙŠÙ‚..", "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø²Ø§Ø±!"];
            
            const interval = setInterval(() => {
                progress += 1;
                E.bar.style.width = progress + '%';
                
                // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
                if(progress < 25) E.msg.textContent = "Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: " + stages[0];
                else if(progress < 50) E.msg.textContent = "Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: " + stages[1];
                else if(progress < 75) E.msg.textContent = "Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: " + stages[2];
                else E.msg.textContent = "Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: " + stages[3];
                E.msg.style.display = 'block';

                if(progress >= 100) {
                    clearInterval(interval);
                    E.prog.style.display = 'none';
                    E.msg.style.display = 'none';
                    state.isDigging = false;
                    state.zaar += 100;
                    E.zaar.textContent = state.zaar;
                    el.remove();
                    showMsg("ÙˆØ¬Ø¯Ù‘Øª 100 Ù…Ù† Ø·Ø§Ù‚Ø© Ø§Ù„Ø²Ø§Ø±! âš›ï¸");
                }
            }, 150); // 150ms * 100 = 15 Ø«Ø§Ù†ÙŠØ©
        }

        // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø­Ø±ÙƒØ© Ø¹Ø¨Ø± Ø§Ù„Ù„Ù…Ø³
        window.addEventListener('touchstart', (e) => handleTouch(e));
        window.addEventListener('touchmove', (e) => handleTouch(e));

        function handleTouch(e) {
            if(state.isDigging) return;
            const touch = e.touches[0];
            // ØªØ­ÙˆÙŠÙ„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù„Ù…Ø³ Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…
            state.px = touch.pageX - state.camX;
            state.py = touch.pageY - state.camY;
        }

        function gameLoop() {
            // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø¨Ù„
            E.player.style.left = state.px + 'px';
            E.player.style.top = state.py + 'px';

            // Ø°ÙƒØ§Ø¡ Ø§Ù„ØµÙŠØ§Ø¯ (Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©) - ÙŠØ·Ø§Ø±Ø¯Ùƒ Ø¨Ø¨Ø·Ø¡
            const dx = state.px - state.hx;
            const dy = state.py - state.hy;
            state.hx += dx * 0.01;
            state.hy += dy * 0.01;
            E.hunter.style.left = state.hx + 'px';
            E.hunter.style.top = state.hy + 'px';

            // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù„ØµÙŠØ§Ø¯
            const hunterDist = Math.sqrt(dx*dx + dy*dy);
            E.warn.style.display = hunterDist < 300 ? 'block' : 'none';

            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            state.camX = window.innerWidth / 2 - state.px;
            state.camY = window.innerHeight / 2 - state.py;
            E.world.style.transform = `translate(${state.camX}px, ${state.camY}px)`;

            requestAnimationFrame(gameLoop);
        }

        function showMsg(txt) {
            E.msg.textContent = txt;
            E.msg.style.display = 'block';
            setTimeout(() => E.msg.style.display = 'none', 3000);
        }

        function openShop() {
            showMsg("ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±: Ù‚Ø±ÙŠØ¨Ø§Ù‹ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø²Ø§Ø± Ø¨Ù€ LAST");
        }

        function saveGame() {
            const data = { zaar: state.zaar, lvl: state.lvl, last: state.last };
            localStorage.setItem('lion_game_save', JSON.stringify(data));
            showMsg("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù…! ğŸ’¾");
        }

        function loadGame() {
            const saved = localStorage.getItem('lion_game_save');
            if(saved) {
                const data = JSON.parse(saved);
                state.zaar = data.zaar;
                state.lvl = data.lvl;
                state.last = data.last;
                E.zaar.textContent = state.zaar;
                E.lvl.textContent = state.lvl;
                E.last.textContent = state.last;
            }
        }
    </script>
</body>
</html>
