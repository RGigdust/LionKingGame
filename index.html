<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>THE LAST MILLION | العرين</title>
    <style>
        body { background: #080808; color: gold; font-family: 'Cairo', sans-serif; margin: 0; touch-action: none; overflow: hidden; text-align: center; }
        .vault-box { padding: 15px; background: #111; border-bottom: 2px solid gold; font-size: 20px; box-shadow: 0 0 15px gold; }
        #stage { height: 60vh; position: relative; display: flex; justify-content: center; align-items: center; }
        #lion { width: 220px; transition: transform 0.1s; z-index: 10; cursor: grab; }
        .mentor { position: absolute; top: 20px; width: 60px; }
        #gate { position: absolute; bottom: 10%; width: 280px; height: 350px; border: 4px dashed #333; border-radius: 140px 140px 0 0; }
        .unlocked { border: 4px solid gold; box-shadow: 0 0 30px gold; background: rgba(255,215,0,0.1); }
        .progress-box { width: 85%; height: 12px; background: #222; border-radius: 10px; margin: 20px auto; border: 1px solid #444; overflow: hidden; }
        #fill { width: 0%; height: 100%; background: linear-gradient(90deg, orange, gold); }
    </style>
</head>
<body>
    <div class="vault-box">الوعاء الملكي: <span id="vault">250,000</span> $LAST</div>
    <div id="stage">
        <img id="owl" src="owl.png" class="mentor" style="right: 20px;">
        <img id="monkey" src="monkey.png" class="mentor" style="left: 20px; display: none;">
        <div id="gate"></div>
        <img id="lion" src="shibl.png">
    </div>
    <div id="status">اسحب الشبل يميناً ويساراً لجمع "الزار"</div>
    <div class="progress-box"><div id="fill"></div></div>
    <div style="font-size: 18px;">رصيد الزار: <span id="zar-balance">0</span></div>

    <script>
        let db = {
            zar: parseInt(localStorage.getItem('zar')) || 0,
            isKing: localStorage.getItem('isKing') === 'true',
            vault: 250000
        };

        const lion = document.getElementById('lion');
        const fill = document.getElementById('fill');
        let startX = 0, miningTime = 0, isMining = false;
        let limit = db.isKing ? 5000 : 15000; // 5 ثواني أو 15 ثانية

        function updateUI() {
            document.getElementById('zar-balance').innerText = db.zar;
            document.getElementById('vault').innerText = (db.vault - db.zar).toLocaleString();
            if (db.isKing) {
                lion.src = "lion_king.png";
                document.getElementById('gate').classList.add('unlocked');
                document.getElementById('owl').style.display = "none";
                document.getElementById('monkey').style.display = "block";
            }
        }

        lion.addEventListener('touchstart', (e) => { 
            startX = e.touches[0].clientX; 
            if(!isMining) { isMining = true; miningTime = Date.now(); }
        });

        window.addEventListener('touchmove', (e) => {
            if(!isMining) return;
            let currentX = e.touches[0].clientX;
            let move = currentX - startX;
            lion.style.transform = `translateX(${move/2}px) rotate(${move/15}deg)`;
            
            let elapsed = Date.now() - miningTime;
            let progress = (elapsed / limit) * 100;
            
            if(progress <= 100) {
                fill.style.width = progress + "%";
            } else {
                finish();
            }
        });

        function finish() {
            isMining = false;
            let gain = db.isKing ? 50 : 10;
            db.zar += gain;
            localStorage.setItem('zar', db.zar);
            if(db.zar >= 1000 && !db.isKing) {
                db.isKing = true;
                localStorage.setItem('isKing', 'true');
                limit = 5000;
                alert("تم التطور! تحول الشبل لأسد وانفتحت البوابة.");
            }
            updateUI();
            fill.style.width = "0%";
            lion.style.transform = "translateX(0)";
        }

        updateUI();
    </script>
</body>
</html>

