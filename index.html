<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø´Ø¨Ù„</title>
    <style>
        body { margin: 0; overflow: hidden; background: #2d5a27; touch-action: none; }
        #world { position: relative; width: 100vw; height: 100vh; }
        
        /* Ø§Ù„Ø´Ø¨Ù„ */
        #character { 
            position: absolute; font-size: 60px; 
            left: 50%; top: 50%; 
            transform: translate(-50%, -50%);
            z-index: 100; pointer-events: none; /* Ø¹Ø´Ø§Ù† Ù…ÙŠØ¹Ù„Ù‚Ø´ ØªØ­Øª Ø§Ù„ØµØ¨Ø§Ø¹ */
        }

        .item { position: absolute; font-size: 40px; z-index: 50; }
        #lake { position: absolute; bottom: 0; left: 0; width: 150px; height: 150px; background: rgba(0,0,255,0.3); border-radius: 0 100% 0 0; border: 2px solid white; color: white; display: flex; align-items: center; justify-content: center; }
        
        #hud { position: fixed; top: 10px; width: 100%; display: flex; justify-content: space-around; color: gold; font-weight: bold; z-index: 1000; text-shadow: 1px 1px black; }
        #owl { position: fixed; bottom: 20px; right: 20px; font-size: 50px; z-index: 1001; cursor: pointer; }
        .digging { opacity: 0.5; transform: scale(0.7) !important; }
    </style>
</head>
<body>

<div id="hud">
    <div>ğŸ’°: <span id="coins">0</span></div>
    <div>ğŸ§¬: <span id="level">Ø´Ø¨Ù„</span></div>
    <div id="hMsg">ğŸ¹: Ù†Ø§Ø¦Ù…</div>
</div>

<div id="world">
    <div id="lake">Ø§Ù„Ø¨Ø­ÙŠØ±Ø©</div>
    <div id="character">ğŸ¦</div>
    <div id="hunter" class="item" style="display:none;">ğŸ•µï¸â€â™‚ï¸</div>
    <div id="prey" class="item">ğŸ‡</div>
    <div id="chameleon" class="item">ğŸ¦</div>
</div>

<div id="owl">ğŸ¦‰</div>

<script>
    const char = document.getElementById('character');
    const coinsTxt = document.getElementById('coins');
    const levelTxt = document.getElementById('level');
    const hunter = document.getElementById('hunter');
    const owl = document.getElementById('owl');
    
    let coins = 0;
    let speed = 1;
    let isDigging = false;

    // --- Ø§Ù„Ø­Ø±ÙƒØ© (Ø£Ù‡Ù… Ø¬Ø²Ø¡) ---
    // Ø¨Ù†Ø®Ù„ÙŠ Ø§Ù„Ù„Ù…Ø³ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒÙ„Ù‡Ø§ (body) Ø¹Ø´Ø§Ù† Ø§Ù„Ø´Ø¨Ù„ ÙŠÙ„Ø­Ù‚ ØµØ¨Ø§Ø¹Ùƒ
    document.body.addEventListener('touchmove', (e) => {
        if (isDigging) return;
        e.preventDefault(); // Ø¨ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ù†Ù‡ ÙŠØ¹Ù…Ù„ Ø³ÙƒØ±ÙˆÙ„ Ø£Ùˆ ÙŠØ¨ÙˆØ¸ Ø§Ù„Ø­Ø±ÙƒØ©
        let t = e.touches[0];
        char.style.left = t.clientX + 'px';
        char.style.top = t.clientY + 'px';
        checkCollisions();
    }, { passive: false });

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙŠØ¯ ÙˆØ§Ù„ØªØ·ÙˆØ± ---
    function checkCollisions() {
        let charRect = char.getBoundingClientRect();
        let prey = document.getElementById('prey');
        let cham = document.getElementById('chameleon');

        // ØµÙŠØ¯ Ø§Ù„ÙØ±ÙŠØ³Ø©
        if (isHit(charRect, prey.getBoundingClientRect())) {
            coins += 10;
            spawn(prey);
            updateGame();
        }

        // ØµÙŠØ¯ Ø§Ù„Ø­Ø±Ø¨Ø§Ø¡ (ØªØ¨Ø·Ø¦ Ø§Ù„Ø­Ø±ÙƒØ©)
        if (isHit(charRect, cham.getBoundingClientRect())) {
            speed = 0.2;
            char.style.filter = "grayscale(1)";
            setTimeout(() => { speed = 1; char.style.filter = "none"; }, 5000);
            spawn(cham);
        }
    }

    function isHit(r1, r2) {
        return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);
    }

    function spawn(el) {
        el.style.left = Math.random() * 80 + 'vw';
        el.style.top = Math.random() * 80 + 'vh';
    }

    function updateGame() {
        coinsTxt.innerText = coins;
        if (coins > 50 && coins < 100) { levelTxt.innerText = "Ø´Ø§Ø¨"; char.innerText = "ğŸ†"; }
        if (coins >= 100) { levelTxt.innerText = "Ø£Ø³Ø¯ Ù…Ù„Ùƒ"; char.innerText = "ğŸ¦"; char.style.fontSize = "80px"; }
    }

    // --- Ø§Ù„Ø¨ÙˆÙ…Ø© (Ø§Ù„Ø­ÙØ± 15 Ø«Ø§Ù†ÙŠØ©) ---
    owl.onclick = () => {
        if (isDigging) return;
        isDigging = true;
        char.classList.add('digging');
        owl.style.opacity = "0.2";
        setTimeout(() => {
            isDigging = false;
            char.classList.remove('digging');
            owl.style.opacity = "1";
            coins += 30;
            updateGame();
        }, 15000);
    };

    // --- Ø§Ù„ØµÙŠØ§Ø¯ Ø§Ù„Ø¯ÙˆØ±ÙŠ ---
    setInterval(() => {
        let active = Math.random() > 0.5;
        hunter.style.display = active ? 'block' : 'none';
        document.getElementById('hMsg').innerText = active ? "ğŸ¹: Ø§Ù‡Ø±Ø¨!" : "ğŸ¹: Ù†Ø§Ø¦Ù…";
        if(active) spawn(hunter);
    }, 10000);

    // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØµÙŠØ§Ø¯ Ø®Ù„ÙÙƒ Ø¨Ø¨Ø·Ø¡
    setInterval(() => {
        if (hunter.style.display === 'block' && !isDigging) {
            let hX = hunter.offsetLeft, hY = hunter.offsetTop;
            let cX = char.offsetLeft, cY = char.offsetTop;
            hunter.style.left = hX + (cX - hX) * 0.05 + 'px';
            hunter.style.top = hY + (cY - hY) * 0.05 + 'px';
            
            if(isHit(char.getBoundingClientRect(), hunter.getBoundingClientRect())) {
                coins = Math.max(0, coins - 1);
                coinsTxt.innerText = coins;
            }
        }
    }, 50);

    spawn(document.getElementById('prey'));
    spawn(document.getElementById('chameleon'));
</script>

</body>
</html>
