<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE LAST MILLION | Ø§Ù„Ø¹Ø±ÙŠÙ†</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <style>
        :root { --gold: #d4af37; --night-sky: #050b1a; --day-sky: #4CAF50; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }

        /* 1. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© */
        #gate-screen {
            position: fixed; inset: 0; background: #000; z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
        }

        /* 2. Ø§Ù„Ø¹Ø§Ù„Ù… (Ø§Ù„ØºØ§Ø¨Ø©) */
        #game-world {
            display: none; width: 100vw; height: 100vh; position: relative;
            transition: background 2s; overflow: hidden;
        }
        .day { background: linear-gradient(to bottom, #76ba1b, #4CAF50); }
        .night { background: linear-gradient(to bottom, #0a1f0a, #050b1a); }

        /* Ø§Ù„Ø¶Ø¨Ø§Ø¨ Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
        #fog {
            position: absolute; top: 0; left: 0; width: 200%; height: 100%;
            background: url('https://www.transparenttextures.com/patterns/asfalt-dark.png');
            opacity: 0.15; pointer-events: none; animation: fogMove 40s infinite linear; z-index: 50;
        }
        @keyframes fogMove { from { transform: translateX(0); } to { transform: translateX(-50%); } }

        /* Ø§Ù„Ø´Ø¨Ù„ (Ø§Ù„Ù„Ø§Ø¹Ø¨) */
        #lion-player {
            position: absolute; width: 70px; height: 70px; z-index: 100;
            transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.5));
            display: flex; align-items: center; justify-content: center; font-size: 50px;
        }
        .breathing { animation: breathe 1.5s infinite ease-in-out; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬ÙˆÙŠØ© */
        #owl { position: absolute; font-size: 35px; z-index: 60; animation: owlFly 20s infinite linear; }
        @keyframes owlFly { 0% { left: -10%; top: 10%; } 50% { left: 110%; top: 20%; transform: scaleX(-1); } 100% { left: -10%; top: 10%; } }

        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„Ø´Ø§Øª */
        #ui-layer { position: absolute; top: 15px; width: 100%; display: flex; flex-direction: column; align-items: center; z-index: 200; pointer-events: none; }
        #balance-box { background: rgba(0,0,0,0.8); border: 1px solid var(--gold); padding: 10px 25px; border-radius: 30px; color: var(--gold); font-weight: bold; font-size: 1.2rem; pointer-events: auto; }
        #lake-mini { position: absolute; bottom: 20px; right: 20px; width: 200px; height: 120px; background: rgba(0,0,0,0.6); border-radius: 10px; padding: 10px; overflow-y: auto; font-size: 0.8rem; pointer-events: auto; border: 1px solid #333; }
        
        .gem { position: absolute; font-size: 25px; cursor: pointer; z-index: 90; animation: breathe 1s infinite; }
        input, button { pointer-events: auto; }
    </style>
</head>
<body class="day">

    <div id="gate-screen">
        <div style="font-size: 80px; margin-bottom: 20px;">ğŸ¦‰</div>
        <h2 style="color: var(--gold);">Ø¹Ø±ÙŠÙ† Ø§Ù„Ù…Ù„ÙŠÙˆÙ† Ø§Ù„Ø£Ø®ÙŠØ±</h2>
        <p style="color: #666; width: 80%;">"Ø´ÙŠØ¡ Ù†Ù…Ù„ÙƒÙ‡ Ø¬Ù…ÙŠØ¹Ø§Ù‹.. Ù„ÙƒÙ†Ù‡ ÙŠÙ‡Ø±Ø¨ Ù…Ù†Ø§ ÙƒÙ„Ù…Ø§ Ø­Ø§ÙˆÙ„Ù†Ø§ Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ Ø¨Ù‡ØŒ ÙÙ…Ù† Ù†Ø­Ù†ØŸ"</p>
        <input type="text" id="pass" placeholder="Ø­Ù„ Ø§Ù„Ù„ØºØ²..." style="padding: 10px; border-radius: 5px; border: 1px solid var(--gold); background: #111; color: #fff; text-align: center;">
        <br>
        <button onclick="checkGate()" style="padding: 10px 30px; background: var(--gold); border: none; font-weight: bold; cursor: pointer; border-radius: 5px;">ÙØªØ­ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©</button>
    </div>

    <div id="game-world">
        <div id="fog"></div>
        <div id="owl">ğŸ¦‰</div>
        
        <div id="ui-layer">
            <div id="balance-box">ğŸª™ $LAST: <span id="bal">0.0000</span></div>
        </div>

        <div id="lion-player" class="breathing">ğŸ¦</div>

        <div id="lake-mini" id="lake-content">
            <div style="color: var(--gold); font-size: 0.7rem; margin-bottom: 5px;">Ù‡Ù…Ø³Ø§Øª Ø§Ù„Ø¨Ø­ÙŠØ±Ø©...</div>
            <div id="messages"></div>
        </div>
    </div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCegNsEjJJDqVQK80If3lvHUKHBACBkP8U",
        authDomain: "thelastmillion-b4e69.firebaseapp.com",
        databaseURL: "https://thelastmillion-b4e69-default-rtdb.firebaseio.com",
        projectId: "thelastmillion-b4e69",
        storageBucket: "thelastmillion-b4e69.firebasestorage.app",
        messagingSenderId: "667969923379",
        appId: "1:667969923379:web:f439369a7056da14cff646"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let balance = 0.0000;
    let myName = "Ø£Ø³Ø¯";

    // 1. ÙØªØ­ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©
    function checkGate() {
        const val = document.getElementById('pass').value;
        if(val.includes("Ø­ÙØ±") || val.includes("Ù…Ù„Ùƒ") || val.includes("Ø£Ù†ÙØ§Ø³")) {
            myName = prompt("Ù…Ø§ Ù‡Ùˆ Ù„Ù‚Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¹Ø±ÙŠÙ†ØŸ") || "Ø£Ø³Ø¯ Ù…Ø¬Ù‡ÙˆÙ„";
            document.getElementById('gate-screen').style.display = 'none';
            document.getElementById('game-world').style.display = 'block';
            initGame();
        } else {
            alert("Ø§Ù„Ø¨ÙˆÙ…Ø© Ù„Ø§ ØªØ¹Ø±ÙÙƒ.");
        }
    }

    function initGame() {
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§Ø±
        const hour = new Date().getHours();
        document.body.className = (hour < 6 || hour > 18) ? "night" : "day";

        // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø¨Ù„ Ø¨Ø§Ù„Ù„Ù…Ø³
        const world = document.getElementById('game-world');
        const lion = document.getElementById('lion-player');

        world.addEventListener('mousedown', (e) => {
            lion.style.left = (e.clientX - 35) + 'px';
            lion.style.top = (e.clientY - 35) + 'px';
            balance += 0.0001;
            document.getElementById('bal').innerText = balance.toFixed(4);
        });

        // Ø±Ø¨Ø· Ø§Ù„Ø´Ø§Øª Ø¨Ø§Ù„Ø¨Ø­ÙŠØ±Ø©
        db.ref('lake').limitToLast(10).on('child_added', (snap) => {
            const d = snap.val();
            const msgDiv = document.createElement('div');
            msgDiv.innerHTML = `<b style="color:gold">${d.rank}:</b> ${d.text}`;
            msgDiv.style.marginBottom = "5px";
            document.getElementById('messages').appendChild(msgDiv);
            document.getElementById('lake-mini').scrollTop = document.getElementById('lake-mini').scrollHeight;
        });

        // Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± (Ø§Ù„ØµÙŠØ¯)
        setInterval(spawnGem, 4000);
    }

    function spawnGem() {
        const gem = document.createElement('div');
        gem.className = 'gem';
        gem.innerHTML = "ğŸ’";
        gem.style.left = Math.random() * 80 + "vw";
        gem.style.top = Math.random() * 80 + "vh";
        gem.onclick = () => {
            balance += 0.0050;
            document.getElementById('bal').innerText = balance.toFixed(4);
            gem.remove();
            // Ø¥Ø±Ø³Ø§Ù„ "Ù†ÙØ³" Ù„Ù„Ø¨Ø­ÙŠØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„ØµÙŠØ¯ Ø§Ù„Ø«Ù…ÙŠÙ†
            db.ref('lake').push({rank: myName, text: "Ø§ØµØ·Ø§Ø¯ Ø¬ÙˆÙ‡Ø±Ø©!", time: Date.now()});
        };
        document.getElementById('game-world').appendChild(gem);
        setTimeout(() => gem.remove(), 6000);
    }
</script>
</body>
</html>
