<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ¦ Ø£Ø³Ø·ÙˆØ±Ø© Ù…Ù„Ùƒ Ø§Ù„ØºØ§Ø¨Ø© - Ø§Ù„ØªØ·ÙˆØ±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body { overflow: hidden; background: #2d5a27; font-family: 'Segoe UI', sans-serif; }

        #gameWorld { position: relative; width: 100vw; height: 100vh; background: #3d7038; overflow: hidden; }
        
        /* Ø§Ù„Ø¨Ø­ÙŠØ±Ø© ÙˆØ§Ù„Ù…Ù†ØµØ© */
        #lake { position: absolute; bottom: 20px; left: 20px; width: 250px; height: 180px; background: #4fa1ff; border-radius: 50%; border: 4px solid #fff; z-index: 10; }
        #platform { position: absolute; top: -40px; left: 50%; transform: translateX(-50%); background: #8b4513; color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; white-space: nowrap; }

        /* Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª */
        .entity { position: absolute; transition: transform 0.2s; display: flex; align-items: center; justify-content: center; z-index: 50; }
        #character { font-size: 50px; z-index: 100; }
        #hunter { font-size: 50px; display: none; z-index: 110; color: red; }
        .prey { font-size: 30px; }
        .chest { font-size: 35px; background: rgba(255,215,0,0.2); border-radius: 10px; }
        .chameleon { font-size: 30px; filter: opacity(0.5); }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        #hud { position: fixed; top: 10px; width: 100%; display: flex; justify-content: space-around; z-index: 2000; pointer-events: none; }
        .status { background: rgba(0,0,0,0.8); color: #ffd700; padding: 8px 15px; border-radius: 15px; border: 1px solid #ffd700; }
        
        #owl { position: fixed; bottom: 20px; right: 20px; font-size: 3em; z-index: 1000; cursor: pointer; }
        .digging { filter: brightness(0.5); transform: scale(0.8); }
    </style>
</head>
<body>

<div id="hud">
    <div class="status">ğŸ’° Ø¹Ù…Ù„Ø§Øª: <span id="coins">0</span></div>
    <div class="status">ğŸ§¬ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="stage">Ø´Ø¨Ù„</span></div>
    <div class="status">ğŸ¹ Ø§Ù„ØµÙŠØ§Ø¯: <span id="hunterStatus">Ù†Ø§Ø¦Ù…</span></div>
</div>

<div id="gameWorld" id="mainStage">
    <div id="lake">
        <div id="platform">ğŸ“¢ Ù…Ù†ØµØ© Ø§Ù„Ù…ØºØ§Ù…Ø±Ø§Øª: Ø§Ø³ØªØ±Ø­ Ù‡Ù†Ø§!</div>
    </div>
    <div id="character" class="entity">ğŸ¦</div>
    <div id="hunter" class="entity">ğŸ•µï¸â€â™‚ï¸</div>
    </div>

<div id="owl">ğŸ¦‰</div>

<script>
    const world = document.getElementById('gameWorld');
    const char = document.getElementById('character');
    const hunter = document.getElementById('hunter');
    const owl = document.getElementById('owl');
    
    let coins = 0;
    let evolution = 0; // 0: Ø´Ø¨Ù„, 1: Ø´Ø§Ø¨, 2: Ø£Ø³Ø¯
    let charX = 200, charY = 200;
    let hunterActive = false;
    let speedMultiplier = 1;

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø±ÙƒØ© ---
    window.addEventListener('touchstart', moveEvent);
    window.addEventListener('touchmove', moveEvent);
    function moveEvent(e) {
        charX = e.touches[0].clientX - 40;
        charY = e.touches[0].clientY - 40;
        char.style.left = charX + 'px';
        char.style.top = charY + 'px';
        checkCollisions();
    }

    // --- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ---
    function spawn(type, emoji, className) {
        const el = document.createElement('div');
        el.className = 'entity ' + className;
        el.innerHTML = emoji;
        el.style.left = Math.random() * (window.innerWidth - 50) + 'px';
        el.style.top = Math.random() * (window.innerHeight - 50) + 'px';
        world.appendChild(el);
        return el;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ ÙØ±Ø§Ø¦Ø³ ÙˆØµÙ†Ø§Ø¯ÙŠÙ‚ Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹
    let rabbit = spawn('prey', 'ğŸ‡', 'prey');
    let chest = spawn('chest', 'ğŸ“¦', 'chest');
    let fakeProject = spawn('chameleon', 'ğŸ¦', 'chameleon');

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµØ§Ø¯Ù… ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ ---
    function checkCollisions() {
        const charRect = char.getBoundingClientRect();

        // 1. ØµÙŠØ¯ Ø§Ù„ÙØ±Ø§Ø¦Ø³
        [rabbit].forEach(p => {
            if (isColliding(charRect, p.getBoundingClientRect())) {
                let reward = (evolution + 1) * 5;
                coins += reward;
                updateHUD();
                resetEntity(p);
                checkEvolution();
            }
        });

